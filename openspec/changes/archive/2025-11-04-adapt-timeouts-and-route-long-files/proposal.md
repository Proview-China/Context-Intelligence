# 变更提案：按文件长度/大小自适应超时，并为长/大文件路由到“长时通道”

## Why
在实际运行中，极长或极大的文件更容易因流式空闲或整体超时而被中断。需要降低阈值并提供长时通道，以保证长/大文件稳定完成，同时不降低整体并发且禁止分片处理。

## 背景与动机
在实际运行中，极长或极大的文件更容易因流式空闲或整体超时而被中断。我们希望：
- 根据文件长度/大小，对请求超时进行自适应预测；
- 将长/大文件路由到一个“长时通道”（不限时或显著更大的超时），避免被中断；
- 保持并发不降低；明确“禁止分片处理”。

## 目标
- 基于文件字节数/行数进行阈值判断，映射到不同超时策略；
- 新增“长时通道”（Long-Channel）：
  - 默认将普通 `request/idle` 超时放大 5 倍（可通过 multiplier 配置）；
  - 也可通过参数显式设为不限时（0 表示不限时）；
  - 与常规通道并行运行，保持总并发不降低；
- 日志标注每个文件的通道与所用超时；
- 默认策略合理，参数可配置；保持向后兼容。

## 非目标
- 不做“内容分片处理”（明确禁止）。
- 不通过降低整体并发来回避长文件问题（明确禁止）。

## What Changes
- CLI 新增或调整参数：阈值（bytes/lines）、长通道启用、超时倍数/覆盖项、自适应 idle 开关。
- Processor 引入双通道路由，保持总并发不降低；长通道请求超时/idle 超时应用 5 倍或显式值；自适应 idle 基于 p95 流间隔。
- 日志增加通道与最终超时配置。
- README 增补参数说明与使用建议。

## 影响面
- CLI/配置：新增阈值与通道策略参数；
- Processor：双通道队列调度，保持总并发不降；按策略动态设置 request/idle 超时；
- 日志：增加通道、阈值命中、实际超时的打印；
- 文档：README 参数与使用建议更新。

## 验收
- 包含长/大文件的目录中：长/大文件应路由至长时通道并成功完成，不再因超时中断；
- 总并发不小于未启用本功能时的值；
- 禁止分片，且日志能展示通道与超时策略；
- 默认阈值下的行为可复现，并可通过参数重写。

## 里程碑
- P1：参数与策略落地（含 multiplier=5.0）、双通道调度、日志与 README；
- P2：策略自适应（基于历史吞吐微调超时）、更精细的公平调度；
